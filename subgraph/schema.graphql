# AlphaNest Subgraph Schema

type Pool @entity {
  id: ID!
  poolId: BigInt!
  token: Bytes!
  totalRugBets: BigInt!
  totalSafeBets: BigInt!
  expiresAt: BigInt!
  minBet: BigInt!
  maxBet: BigInt!
  status: PoolStatus!
  outcome: Outcome!
  resolvedAt: BigInt
  totalPayout: BigInt
  createdAt: BigInt!
  createdTx: Bytes!
  policies: [Policy!]! @derivedFrom(field: "pool")
}

type Policy @entity {
  id: ID!
  policyId: BigInt!
  pool: Pool!
  holder: User!
  position: Position!
  amount: BigInt!
  claimed: Boolean!
  payout: BigInt
  createdAt: BigInt!
  createdTx: Bytes!
  claimedAt: BigInt
  claimedTx: Bytes
}

type User @entity {
  id: ID!
  address: Bytes!
  totalPolicies: BigInt!
  totalInvested: BigInt!
  totalPayout: BigInt!
  totalWins: BigInt!
  totalLosses: BigInt!
  policies: [Policy!]! @derivedFrom(field: "holder")
  createdAt: BigInt!
}

type PoolResolution @entity {
  id: ID!
  pool: Pool!
  outcome: Outcome!
  totalPayout: BigInt!
  timestamp: BigInt!
  tx: Bytes!
}

type TokenReport @entity {
  id: ID!
  reportId: BigInt!
  token: Bytes!
  status: TokenStatus!
  reporter: Bytes!
  evidence: String!
  liquidityDrop: BigInt
  priceDrop: BigInt
  reportedAt: BigInt!
  resolvedAt: BigInt
  disputes: [Dispute!]! @derivedFrom(field: "report")
}

type Dispute @entity {
  id: ID!
  disputeId: BigInt!
  report: TokenReport!
  disputer: Bytes!
  reason: String!
  resolved: Boolean!
  accepted: Boolean
  disputedAt: BigInt!
  resolvedAt: BigInt
}

type GlobalStats @entity {
  id: ID!
  totalPools: BigInt!
  totalPolicies: BigInt!
  totalVolume: BigInt!
  totalPayouts: BigInt!
  totalUsers: BigInt!
  totalRugDetected: BigInt!
}

enum PoolStatus {
  ACTIVE
  RESOLVED
  CANCELLED
}

enum Outcome {
  PENDING
  RUGGED
  SAFE
  CANCELLED
}

enum Position {
  RUG
  SAFE
}

enum TokenStatus {
  UNKNOWN
  SAFE
  RUGGED
  DISPUTED
}
